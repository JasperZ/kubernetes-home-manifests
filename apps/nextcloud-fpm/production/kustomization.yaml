bases:
- ../base
resources:
- resources/nextcloud/certificate.yaml
- resources/nextcloud/ingress.yaml
- resources/nextcloud/persistent_volumes.yaml
- resources/nextcloud/persistent_volume_claims.yaml
- resources/nextcloud/cronjob.yaml
- resources/mariadb/persistent_volumes.yaml
- resources/mariadb/persistent_volume_claims.yaml
- resources/redis/persistent_volumes.yaml
- resources/redis/persistent_volume_claims.yaml
- resources/onlyoffice/deployment.yaml
- resources/onlyoffice/service.yaml
- resources/onlyoffice/certificate.yaml
- resources/onlyoffice/ingress.yaml
patchesStrategicMerge:
- patches/set_nextcloud_trusted_domain.yaml
- patches/set_resources.yaml
- patches/add_mariadb_volumes.yaml
- patches/add_redis_volumes.yaml
patchesJson6902:
- target:
    group: apps
    version: v1
    kind: Deployment
    name: nextcloud
  path: patches/add_nextcloud_volumes.json
namePrefix: production-nextcloud-
commonLabels:
  app: nextcloud
  env: production
images:
- name: nextcloud-fpm
  newName: nextcloud
  newTag: 16.0.4-fpm-alpine
- name: mariadb
  newName: mariadb
  newTag: 10.4.6-bionic
- name: redis
  newName: redis
  newTag: 5.0.5-alpine
- name: nginx
  newName: nginx
  newTag: 1.17.1-alpine
- name: onlyoffice
  newName: onlyoffice/documentserver
  newTag: 5.2.8.24
secretGenerator:
- name: bucket
  envs:
  - production-nextcloud.env
generatorOptions:
  labels:
    component: nextcloud
vars:
- name: NEXTCLOUD_INGRESS_DOMAIN
  objref:
    kind: Certificate
    name: nextcloud-jz-c-org
    apiVersion: certmanager.k8s.io/v1alpha1
  fieldref:
    fieldpath: metadata.annotations.domain
